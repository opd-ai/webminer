<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üîç WebMiner API Validation Test</h1>
    <p>This test validates that all documented API methods are available and working correctly.</p>
    
    <div id="test-results"></div>
    
    <script src="../webminer.js"></script>
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, status) {
            const div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        function runAPIValidationTests() {
            addResult('üöÄ Starting API validation tests...', 'info');
            
            // Test 1: WebMiner class availability
            try {
                const miner = new WebMiner({
                    pool: 'wss://test.pool',
                    wallet: 'test_wallet_address',
                    throttle: 0.25
                });
                addResult('‚úÖ WebMiner class instantiation: PASS', 'pass');
            } catch (error) {
                addResult('‚ùå WebMiner class instantiation: FAIL - ' + error.message, 'fail');
            }
            
            // Test 2: MiningConsent module availability
            try {
                if (typeof MiningConsent !== 'undefined' && MiningConsent.init) {
                    addResult('‚úÖ MiningConsent module: PASS', 'pass');
                } else {
                    addResult('‚ùå MiningConsent module: FAIL - Not available', 'fail');
                }
            } catch (error) {
                addResult('‚ùå MiningConsent module: FAIL - ' + error.message, 'fail');
            }
            
            // Test 3: PerformanceMonitor module availability  
            try {
                if (typeof PerformanceMonitor !== 'undefined' && PerformanceMonitor.init) {
                    addResult('‚úÖ PerformanceMonitor module: PASS', 'pass');
                } else {
                    addResult('‚ùå PerformanceMonitor module: FAIL - Not available', 'fail');
                }
            } catch (error) {
                addResult('‚ùå PerformanceMonitor module: FAIL - ' + error.message, 'fail');
            }
            
            // Test 4: MobileOptimizer module availability
            try {
                if (typeof MobileOptimizer !== 'undefined' && MobileOptimizer.init) {
                    addResult('‚úÖ MobileOptimizer module: PASS', 'pass');
                } else {
                    addResult('‚ùå MobileOptimizer module: FAIL - Not available', 'fail');
                }
            } catch (error) {
                addResult('‚ùå MobileOptimizer module: FAIL - ' + error.message, 'fail');
            }
            
            // Test 5: WebMiner methods availability
            try {
                const miner = new WebMiner({ pool: 'test', wallet: 'test' });
                const methods = ['start', 'stop', 'getStats', 'isMining', 'pauseMining', 'resumeMining', 'restartWorker'];
                let methodsAvailable = 0;
                
                methods.forEach(method => {
                    if (typeof miner[method] === 'function') {
                        methodsAvailable++;
                    }
                });
                
                if (methodsAvailable === methods.length) {
                    addResult(`‚úÖ WebMiner methods (${methodsAvailable}/${methods.length}): PASS`, 'pass');
                } else {
                    addResult(`‚ùå WebMiner methods (${methodsAvailable}/${methods.length}): FAIL`, 'fail');
                }
            } catch (error) {
                addResult('‚ùå WebMiner methods test: FAIL - ' + error.message, 'fail');
            }
            
            // Test 6: Configuration validation
            try {
                const config = {
                    pool: 'wss://test.pool',
                    wallet: 'test_wallet',
                    throttle: 0.25,
                    enablePerformanceMonitoring: true,
                    enableMobileOptimizations: true,
                    pauseWhenHidden: true
                };
                
                const miner = new WebMiner(config);
                
                if (miner.config.throttle === 0.25 && 
                    miner.config.enablePerformanceMonitoring === true) {
                    addResult('‚úÖ Configuration handling: PASS', 'pass');
                } else {
                    addResult('‚ùå Configuration handling: FAIL - Config not applied correctly', 'fail');
                }
            } catch (error) {
                addResult('‚ùå Configuration test: FAIL - ' + error.message, 'fail');
            }
            
            // Test 7: Performance monitoring initialization
            try {
                PerformanceMonitor.init().then(() => {
                    if (PerformanceMonitor.metrics && PerformanceMonitor.stats) {
                        addResult('‚úÖ PerformanceMonitor initialization: PASS', 'pass');
                    } else {
                        addResult('‚ùå PerformanceMonitor initialization: FAIL - Metrics not available', 'fail');
                    }
                }).catch(error => {
                    addResult('‚ùå PerformanceMonitor initialization: FAIL - ' + error.message, 'fail');
                });
            } catch (error) {
                addResult('‚ùå PerformanceMonitor initialization test: FAIL - ' + error.message, 'fail');
            }
            
            // Test 8: Mobile optimizer initialization
            try {
                MobileOptimizer.init();
                if (MobileOptimizer.capabilities) {
                    addResult('‚úÖ MobileOptimizer initialization: PASS', 'pass');
                } else {
                    addResult('‚ùå MobileOptimizer initialization: FAIL - Capabilities not detected', 'fail');
                }
            } catch (error) {
                addResult('‚ùå MobileOptimizer initialization: FAIL - ' + error.message, 'fail');
            }
            
            addResult('üèÅ API validation tests completed!', 'info');
            
            // Test summary
            const passCount = document.querySelectorAll('.pass').length;
            const failCount = document.querySelectorAll('.fail').length;
            addResult(`üìä Results: ${passCount} passed, ${failCount} failed`, passCount > failCount ? 'pass' : 'fail');
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runAPIValidationTests, 100);
        });
    </script>
</body>
</html>